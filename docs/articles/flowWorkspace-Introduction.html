<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>flowWorkspace Introduction: A Package to store and maninpulate gated flow data • flowWorkspace</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="flowWorkspace Introduction: A Package to store and maninpulate gated flow data">
<meta property="og:description" content="flowWorkspace">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">flowWorkspace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">3.99.21</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>flowWorkspace Introduction: A Package to store and maninpulate gated flow data</h1>
                        <h4 class="author">Greg Finak <a href="mailto:gfinak@fhcrc.org" class="email">gfinak@fhcrc.org</a>, Mike Jiang <a href="mailto:wjiang2@fhcrc.org" class="email">wjiang2@fhcrc.org</a>
</h4>
            
      
      
      <div class="hidden name"><code>flowWorkspace-Introduction.Rmd</code></div>

    </div>

    
    
<div id="purpose" class="section level2">
<h2 class="hasAnchor">
<a href="#purpose" class="anchor"></a>Purpose</h2>
<p>The purpose of this package is to provide the infrastructure to store, represent and exchange gated flow data. By this we mean accessing the samples, groups, transformations, compensation matrices, gates, and population statistics in the gating tree, which is represented as a <code>GatingSet</code> object in <code>R</code>.</p>
<p>The <code>GatingSet</code> can be built from scratch within <code>R</code> or imported from <code>flowJo</code> XML workspaces (i.e. <code>.xml</code> or <code>.wsp</code> files) or <code>GatingML</code> files . Note that we cannot import <code>.jo</code> files directly. You will have to save them in XML workspace format.</p>
</div>
<div id="import-flowjo-workspace" class="section level2">
<h2 class="hasAnchor">
<a href="#import-flowjo-workspace" class="anchor"></a>Import flowJo workspace</h2>
<p>The following section walks through opening and importing a flowJo workspace.</p>
<div id="opening-a-workspace" class="section level3">
<h3 class="hasAnchor">
<a href="#opening-a-workspace" class="anchor"></a>Opening a Workspace</h3>
<p>We represent flowJo workspaces using <code>flowjo_workspace</code> objects. We only need to know the path to, and filename of the flowJo workspace.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flowWorkspace</span>)
<span class="no">path</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="kw">package</span><span class="kw">=</span><span class="st">"flowWorkspaceData"</span>)
<span class="no">wsfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">path</span>, <span class="kw">pattern</span><span class="kw">=</span><span class="st">"A2004Analysis.xml"</span>, <span class="kw">full</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>In order to open this workspace we need <code>CytoML</code> package:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">CytoML</span>)</pre></body></html></div>
<pre><code>## Warning: replacing previous import 'ncdfFlow::filter' by 'dplyr::filter' when
## loading 'CytoML'</code></pre>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">ws</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/open_flowjo_xml.html">open_flowjo_xml</a></span>(<span class="no">wsfile</span>)
<span class="no">ws</span></pre></body></html></div>
<pre><code>## File location:  /usr/local/lib/R/cytoset/flowWorkspaceData/extdata/A2004Analysis.xml 
## 
## Groups in Workspace
##          Name Num.Samples
## 1 All Samples           2</code></pre>
<p>We see that this a version 2.0 workspace file. It’s location and filename are printed. Additionally, you are notified that the workspace file is open. This refers to the fact that the XML document is internally represented using ‘C’ data structures from the <code>XML</code> package. After importing the file, the workspace must be explicitly closed using <code>flowjo_ws_close()</code> in order to free up that memory.</p>
<p>For example, the list of samples in a workspace can be accessed by:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/fj_ws_get_samples.html">fj_ws_get_samples</a></span>(<span class="no">ws</span>)</pre></body></html></div>
<pre><code>##   sampleID                       name count pop.counts
## 1        1 a2004_O1T2pb05i_A1_A01.fcs 61832         19
## 2        2 a2004_O1T2pb05i_A2_A02.fcs 45363         19</code></pre>
<p>The <code>compID</code> column tells you which compensation matrix to apply to a group of files, and similarly, based on the name of the compensation matrix, which transformations to apply.</p>
<p>And the groups can be accessed by:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/fj_ws_get_sample_groups.html">fj_ws_get_sample_groups</a></span>(<span class="no">ws</span>)</pre></body></html></div>
<pre><code>##     groupName groupID sampleID
## 1 All Samples       0        1
## 2 All Samples       0        2</code></pre>
<p>Keywords stored in an XML workspace can also retrieved by:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">sn</span> <span class="kw">&lt;-</span> <span class="st">"a2004_O1T2pb05i_A1_A01.fcs"</span>
<span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/fj_ws_get_keywords.html">fj_ws_get_keywords</a></span>(<span class="no">ws</span>, <span class="no">sn</span>)[<span class="fl">1</span>:<span class="fl">5</span>]</pre></body></html></div>
<pre><code>## $`$BEGINANALYSIS`
## [1] "0"
## 
## $`$BEGINDATA`
## [1] "3803"
## 
## $`$BEGINSTEXT`
## [1] "0"
## 
## $`$BTIM`
## [1] "09:20:24"
## 
## $`$BYTEORD`
## [1] "4,3,2,1"</code></pre>
</div>
<div id="parsing-the-workspace" class="section level3">
<h3 class="hasAnchor">
<a href="#parsing-the-workspace" class="anchor"></a>Parsing the Workspace</h3>
<p>These are all retrieved by directly querying xml file. In order to get more information about the gating tree, we need to actually parse the XML workspace into R data structures to represent some of the information therein. Specifically, by calling <code><a href="https://rdrr.io/pkg/CytoML/man/flowjo_to_gatingset.html">flowjo_to_gatingset()</a></code> the user will be presented with a list of <code>groups</code> in the workspace file and need to choose one group to import. Why only one? Because of the way flowJo handles data transformation and compensation. Each group of samples is associated with a compensation matrix and specific data transformation. These are applied to all samples in the group. When a particular group of samples is imported, the package generates a <code>GatingHierarchy</code> for each sample, describing the set of gates applied to the data (note: polygons, rectangles, quadrants, and ovals and boolean gates are supported). The set of GatingHierarchies for the group of samples is stored in a <code>GatingSet</code> object. Calling <code><a href="https://rdrr.io/pkg/CytoML/man/flowjo_to_gatingset.html">flowjo_to_gatingset()</a></code> is quite verbose, informing the user as each gate is created. The parsing can also be done non–interactively by specifying which group to import directly in the function call (either an index or a group name). An additional optional argument <code>execute=T/F</code> specifies whether you want to load, compensate, transform the data and compute statistics immediately after parsing the XML tree. Argument <code>path</code> can be used to specify where the FCS files are stored.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/flowjo_to_gatingset.html">flowjo_to_gatingset</a></span>(<span class="no">ws</span>,<span class="kw">name</span> <span class="kw">=</span> <span class="fl">1</span>); <span class="co">#import the first group</span></pre></body></html></div>
<pre><code>## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!
## invalid zeroChan: -2147483648
## caused by the invalid biexp parameters!Downcast the biexp to Calibration table instead!</code></pre>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="co">#Lots of output here suppressed for the vignette.</span>
<span class="no">gs</span></pre></body></html></div>
<pre><code>## A GatingSet with 2 samples</code></pre>
<p>We have generated a <code>GatingSet</code> with 2 samples, each of which has 19 associated gates.</p>
<p>To list the samples stored in <code>GatingSet</code>:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/sampleNames.html">sampleNames</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>## [1] "a2004_O1T2pb05i_A1_A01.fcs_61832" "a2004_O1T2pb05i_A2_A02.fcs_45363"</code></pre>
<p>Note that it is different from the previous call <code>fj_ws_get_samples</code> on <code>workspace</code> where the latter list all samples stored in <code>xml</code> file and here are the ones actually get parsed. Because sometime not all of samples in xml will be imported for various reason. Also we’ve seen an extra string <code>_xxx</code> is attached to the end of each sample name. It is due to the argument <code>additional.keys</code> has the default value set to <code>'$TOT'</code>. See more details on these parsing options from <a href="http://bioconductor.org/packages/release/bioc/vignettes/flowWorkspace/inst/doc/HowToParseFlowJo.html">How to parse a flowJo workspace</a>.</p>
</div>
</div>
<div id="import-gatingml" class="section level2">
<h2 class="hasAnchor">
<a href="#import-gatingml" class="anchor"></a>Import gatingML</h2>
<p>We currently support gatingML2.0 files exported from the <code>Cytobank</code> system. Parsing can be done with one convenient function, <code>cytobank2GatingSet</code> from the <code>CytoML</code> package, that simply takes file paths of <code>gatingML</code> and <code>FCS</code>.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">xmlfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata/cytotrol_tcell_cytobank.xml"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"CytoML"</span>)
<span class="no">fcsFiles</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="kw">pattern</span> <span class="kw">=</span> <span class="st">"CytoTrol"</span>,
                       <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"flowWorkspaceData"</span>), <span class="kw">full</span> <span class="kw">=</span> <span class="no">T</span>)
<span class="no">gs1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/CytoML/man/cytobank_to_gatingset.html">cytobank2GatingSet</a></span>(<span class="no">xmlfile</span>, <span class="no">fcsFiles</span>)</pre></body></html></div>
<p>If you want to dive into the details and sub-steps of the parsing process, see the vignette of <a href="https://github.com/RGLab/CytoML">CytoML</a>.</p>
</div>
<div id="basics-on-gatingset" class="section level2">
<h2 class="hasAnchor">
<a href="#basics-on-gatingset" class="anchor"></a>Basics on GatingSet</h2>
<p>Subsets of a <code>GatingSet</code> can be accessed using the standard R subset syntax <code><a href="../reference/brackets.html">[</a></code>.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">gs</span>[<span class="fl">1</span>]</pre></body></html></div>
<pre><code>## A GatingSet with 1 samples</code></pre>
<p>At this point we have parsed the workspace file and generated the gating hierarchy associated with each sample imported from the file. The data have been loaded, compensated, and transformed in the workspace, and gating has been executed. The resulting <code>GatingSet</code> contains a replicated analysis of the original flowJo workspace. It should be noted, however, that because <code>GatingSet</code> is a purely reference class, this sort of subsetting does not copy the underlying data but rather utilizes a view of it.</p>
<p>We can plot the gating tree:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/plotTree-1.png" width="700"></p>
<p>We can list the nodes (populations) in the gating hierarchy:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="fl">1</span>)</pre></body></html></div>
<pre><code>##  [1] "root"       "Live"       "APC"        "B Cell"     "mDC"       
##  [6] "IFNa+"      "IL-6+"      "IL-12+"     "TNFa+"      "pDC"       
## [11] "IFNa+"      "IL-6+"      "IL-12+"     "TNFa+"      "CD14-MHC2-"
## [16] "Monocytes"  "IFNa+"      "IL-6+"      "IL-12+"     "TNFa+"</code></pre>
<p>Note that the <code>path</code> argument specifies the depth of the gating path for each population. As shown, <code>depth</code> of <code>1</code> (i.e. leaf or terminal node name) may not be sufficient to uniquely identify each population. The issue can be resolved by increasing the <code>path</code> or simply returning the full path of the node:</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"full"</span>)</pre></body></html></div>
<pre><code>##  [1] "root"                   "/Live"                  "/Live/APC"             
##  [4] "/Live/APC/B Cell"       "/Live/APC/mDC"          "/Live/APC/mDC/IFNa+"   
##  [7] "/Live/APC/mDC/IL-6+"    "/Live/APC/mDC/IL-12+"   "/Live/APC/mDC/TNFa+"   
## [10] "/Live/APC/pDC"          "/Live/APC/pDC/IFNa+"    "/Live/APC/pDC/IL-6+"   
## [13] "/Live/APC/pDC/IL-12+"   "/Live/APC/pDC/TNFa+"    "/Live/CD14-MHC2-"      
## [16] "/Live/Monocytes"        "/Live/Monocytes/IFNa+"  "/Live/Monocytes/IL-6+" 
## [19] "/Live/Monocytes/IL-12+" "/Live/Monocytes/TNFa+"</code></pre>
<p>But <code>full</code> path may not be neccessary and could be too long to be visualized. So we provide the <code>path = 'auto'</code> option to determine the shortest path that is still unique within the gating tree.</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">nodelist</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>, <span class="kw">path</span> <span class="kw">=</span> <span class="st">"auto"</span>)
<span class="no">nodelist</span></pre></body></html></div>
<pre><code>##  [1] "root"             "Live"             "APC"              "B Cell"          
##  [5] "mDC"              "mDC/IFNa+"        "mDC/IL-6+"        "mDC/IL-12+"      
##  [9] "mDC/TNFa+"        "pDC"              "pDC/IFNa+"        "pDC/IL-6+"       
## [13] "pDC/IL-12+"       "pDC/TNFa+"        "CD14-MHC2-"       "Monocytes"       
## [17] "Monocytes/IFNa+"  "Monocytes/IL-6+"  "Monocytes/IL-12+" "Monocytes/TNFa+"</code></pre>
<p>We can get the gate associated with the specific population:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">node</span> <span class="kw">&lt;-</span> <span class="no">nodelist</span>[<span class="fl">3</span>]
<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gs_pop_get_gate.html">gs_pop_get_gate</a></span>(<span class="no">gs</span>, <span class="no">node</span>)
<span class="no">g</span></pre></body></html></div>
<pre><code>## $a2004_O1T2pb05i_A1_A01.fcs_61832
## Polygonal gate 'APC' with 14 vertices in dimensions &lt;PerCP-CY5-5-A&gt; and &lt;PE-CY7-A&gt;
## 
## $a2004_O1T2pb05i_A2_A02.fcs_45363
## Polygonal gate 'APC' with 14 vertices in dimensions &lt;PerCP-CY5-5-A&gt; and &lt;PE-CY7-A&gt;</code></pre>
<p>We can retrieve the population statistics :</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_pop_get_count_fast.html">gs_pop_get_count_fast</a></span>(<span class="no">gs</span>)[<span class="fl">1</span>:<span class="fl">10</span>,]</pre></body></html></div>
<pre><code>##                                 name           Population        Parent Count
##  1: a2004_O1T2pb05i_A1_A01.fcs_61832                /Live          root 49484
##  2: a2004_O1T2pb05i_A1_A01.fcs_61832            /Live/APC         /Live  4154
##  3: a2004_O1T2pb05i_A1_A01.fcs_61832     /Live/APC/B Cell     /Live/APC  2311
##  4: a2004_O1T2pb05i_A1_A01.fcs_61832        /Live/APC/mDC     /Live/APC   512
##  5: a2004_O1T2pb05i_A1_A01.fcs_61832  /Live/APC/mDC/IFNa+ /Live/APC/mDC     2
##  6: a2004_O1T2pb05i_A1_A01.fcs_61832  /Live/APC/mDC/IL-6+ /Live/APC/mDC    22
##  7: a2004_O1T2pb05i_A1_A01.fcs_61832 /Live/APC/mDC/IL-12+ /Live/APC/mDC     2
##  8: a2004_O1T2pb05i_A1_A01.fcs_61832  /Live/APC/mDC/TNFa+ /Live/APC/mDC    72
##  9: a2004_O1T2pb05i_A1_A01.fcs_61832        /Live/APC/pDC     /Live/APC   433
## 10: a2004_O1T2pb05i_A1_A01.fcs_61832  /Live/APC/pDC/IFNa+ /Live/APC/pDC     0
##     ParentCount
##  1:       61832
##  2:       49484
##  3:        4154
##  4:        4154
##  5:         512
##  6:         512
##  7:         512
##  8:         512
##  9:        4154
## 10:         433</code></pre>
<p>We can plot individual gates. Note the scale of the transformed axes. The second argument is the node path of any depth as long as it is uniquely identifiable.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggcyto</span>)
<span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">gs</span>, <span class="st">"pDC"</span>)</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/autoplot-nodeName-1.png" width="700"> More details about gate visualization can be found <a href="http://bioconductor.org/packages/release/bioc/html/ggcyto.html">here</a>.</p>
<p>If we have metadata associated with the experiment, it can be attached to the <code>GatingSet</code>.</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">d</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">sample</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sample 1"</span>, <span class="st">"sample 2"</span>)),<span class="kw">treatment</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"sample"</span>,<span class="st">"control"</span>)) )
<span class="no">pd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pData-methods.html">pData</a></span>(<span class="no">gs</span>)
<span class="no">pd</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="no">pd</span>,<span class="no">d</span>)
<span class="fu"><a href="../reference/pData-methods.html">pData</a></span>(<span class="no">gs</span>) <span class="kw">&lt;-</span> <span class="no">pd</span>
<span class="fu"><a href="../reference/pData-methods.html">pData</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>##                                                        name   sample treatment
## a2004_O1T2pb05i_A1_A01.fcs_61832 a2004_O1T2pb05i_A1_A01.fcs sample 1    sample
## a2004_O1T2pb05i_A2_A02.fcs_45363 a2004_O1T2pb05i_A2_A02.fcs sample 2   control</code></pre>
<p>We can subset the <code>GatingSet</code> by its <code>pData</code> directly:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="fu"><a href="../reference/subset.html">subset</a></span>(<span class="no">gs</span>, <span class="no">treatment</span> <span class="kw">==</span> <span class="st">"control"</span>)</pre></body></html></div>
<pre><code>## A GatingSet with 1 samples</code></pre>
<p>The underlying <code>flow data</code> can be retrieved by:</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="no">cs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gh_pop_get_data.html">gs_pop_get_data</a></span>(<span class="no">gs</span>)
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">cs</span>)</pre></body></html></div>
<pre><code>## [1] "cytoset"
## attr(,"package")
## [1] "flowWorkspace"</code></pre>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]])</pre></body></html></div>
<pre><code>## [1] 61832</code></pre>
<p>Because <code>GatingSet</code> is a purely reference class, the class type returned by <code>getData</code> is a <code>cytoset</code>, which is the purely reference class analog of a <code>flowSet</code> and will be discussed in more detail below. Also note that the data is already compensated and transformed during the parsing.</p>
<p>We can retrieve the subset of data associated with a population node:</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">cs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gh_pop_get_data.html">gs_pop_get_data</a></span>(<span class="no">gs</span>, <span class="no">node</span>)
<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(<span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]])</pre></body></html></div>
<pre><code>## [1] 4154</code></pre>
</div>
<div id="gatinghierarchy" class="section level2">
<h2 class="hasAnchor">
<a href="#gatinghierarchy" class="anchor"></a>GatingHierarchy</h2>
<p>We can retrieve a single gating hierarchical tree (corresponding to one sample) by using the <code><a href="../reference/brackets.html">[[</a></code> extraction operator</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">gh</span> <span class="kw">&lt;-</span> <span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="no">gh</span></pre></body></html></div>
<pre><code>## Sample:  a2004_O1T2pb05i_A1_A01.fcs_61832 
## GatingHierarchy with  20  gates</code></pre>
<p>Note that the index can be either numeric or character (the <code>guid</code> returned by the <code>sampleNames</code> method)</p>
<p>We can do similar operations on this <code>GatingHierarchy</code> object and the same methods behave differently from <code>GatingSet</code></p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/gh_pop_compare_stats.html">gh_pop_compare_stats</a></span>(<span class="no">gh</span>))</pre></body></html></div>
<pre><code>##    openCyto.freq    xml.freq openCyto.count xml.count      node
## 1:    1.00000000 1.000000000          61832     61832      root
## 2:    0.80029758 0.801235606          49484     49542      Live
## 3:    0.08394633 0.083585645           4154      4141       APC
## 4:    0.55633125 0.548418256           2311      2271    B Cell
## 5:    0.12325469 0.121226757            512       502       mDC
## 6:    0.00390625 0.003984064              2         2 mDC/IFNa+</code></pre>
<p>Here <code>gh_pop_compare_stats</code> returns both the stats directly stored in <code>flowJo</code> xml workspace and one calcuated by <code>GatingSet</code> through the gating. There are could be minor difference between the two due to the numerical errors. However the difference should not be significant. Therore this can be used as the validity check for the parsing accuracy.</p>
<div class="sourceCode" id="cb47"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_plot_pop_count_cv.html">gh_plot_pop_count_cv</a></span>(<span class="no">gh</span>)</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/gh_plot_pop_count_cv-1.png" width="700"></p>
<p>The <code>autoplot</code> method without specifying any node will lay out all the gates in the same plot</p>
<div class="sourceCode" id="cb48"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">gh</span>)</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>We can retrieve the indices specifying if an event is included inside or outside a gate using:</p>
<div class="sourceCode" id="cb49"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span>(<span class="fu"><a href="../reference/gh_pop_get_indices.html">gh_pop_get_indices</a></span>(<span class="no">gh</span>,<span class="no">node</span>))</pre></body></html></div>
<pre><code>## 
## FALSE  TRUE 
## 57678  4154</code></pre>
<p>The indices returned are relative to the parent population (member of parent AND member of current gate), so they reflect the true hierarchical gating structure.</p>
<p>We can retrieve all the compensation matrices from the <code>GatingHierarchy</code> in case we wish to use the compensation or transformation for the new data,</p>
<div class="sourceCode" id="cb51"><html><body><pre class="r"><span class="no">C</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gh_get_compensations.html">gh_get_compensations</a></span>(<span class="no">gh</span>);
<span class="no">C</span></pre></body></html></div>
<pre><code>## Compensation object 'defaultCompensation':
##                Am Cyan-A Pacific Blue-A    APC-A APC-CY7-A Alexa 700-A
## Am Cyan-A        1.00000        0.04800 0.000000    0.0000     0.00000
## Pacific Blue-A   0.38600        1.00000 0.000529    0.0000     0.00000
## APC-A            0.00642        0.00235 1.000000    0.0611     0.19800
## APC-CY7-A        0.03270        0.02460 0.084000    1.0000     0.02870
## Alexa 700-A      0.07030        0.05800 0.016200    0.3990     1.00000
## FITC-A           0.74500        0.02090 0.001870    0.0000     0.00000
## PerCP-CY5-5-A    0.00368        0.00178 0.015300    0.0269     0.07690
## PE-CY7-A         0.01330        0.00948 0.000951    0.1380     0.00182
##                   FITC-A PerCP-CY5-5-A PE-CY7-A
## Am Cyan-A       0.028500       0.00104  0.00000
## Pacific Blue-A  0.000546       0.00000  0.00000
## APC-A          -0.000611       0.00776  0.00076
## APC-CY7-A       0.002690       0.00304  0.01010
## Alexa 700-A     0.001530       0.10800  0.00679
## FITC-A          1.000000       0.04180  0.00281
## PerCP-CY5-5-A   0.000000       1.00000  0.07030
## PE-CY7-A        0.002340       0.03360  1.00000</code></pre>
<p>Or we can retrieve transformations:</p>
<div class="sourceCode" id="cb53"><html><body><pre class="r"><span class="no">T</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gh_get_transformations.html">gh_get_transformations</a></span>(<span class="no">gh</span>)
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">T</span>)</pre></body></html></div>
<pre><code>##  [1] "&lt;Alexa 700-A&gt;"    "&lt;Am Cyan-A&gt;"      "&lt;APC-A&gt;"          "&lt;APC-CY7-A&gt;"     
##  [5] "&lt;FITC-A&gt;"         "&lt;Pacific Blue-A&gt;" "&lt;PE-CY7-A&gt;"       "&lt;PerCP-CY5-5-A&gt;" 
##  [9] "Alexa 700-H"      "Am Cyan-H"        "APC-CY7-H"        "APC-H"           
## [13] "FITC-H"           "Pacific Blue-H"   "PE-CY7-H"         "PerCP-CY5-5-H"</code></pre>
<div class="sourceCode" id="cb55"><html><body><pre class="r"><span class="no">T</span><span class="kw">[[</span><span class="fl">1</span>]]</pre></body></html></div>
<pre><code>## function (x, deriv = 0) 
## {
##     deriv &lt;- as.integer(deriv)
##     if (deriv &lt; 0 || deriv &gt; 3) 
##         stop("'deriv' must be between 0 and 3")
##     if (deriv &gt; 0) {
##         z0 &lt;- double(z$n)
##         z[c("y", "b", "c")] &lt;- switch(deriv, list(y = z$b, b = 2 * 
##             z$c, c = 3 * z$d), list(y = 2 * z$c, b = 6 * z$d, 
##             c = z0), list(y = 6 * z$d, b = z0, c = z0))
##         z[["d"]] &lt;- z0
##     }
##     res &lt;- stats:::.splinefun(x, z)
##     if (deriv &gt; 0 &amp;&amp; z$method == 2 &amp;&amp; any(ind &lt;- x &lt;= z$x[1L])) 
##         res[ind] &lt;- ifelse(deriv == 1, z$y[1L], 0)
##     res
## }
## &lt;bytecode: 0x5594224be678&gt;
## &lt;environment: 0x55941fab99f0&gt;
## attr(,"type")
## [1] "biexp"
## attr(,"parameters")
## attr(,"parameters")$channelRange
## [1] 4096
## 
## attr(,"parameters")$maxValue
## [1] 262144
## 
## attr(,"parameters")$neg
## [1] 0
## 
## attr(,"parameters")$pos
## [1] 4.5
## 
## attr(,"parameters")$widthBasis
## [1] -10</code></pre>
<p><code>gh_get_transformations</code> returns a list of functions to be applied to different dimensions of the data. Above, the transformation is applied to this sample, the appropriate dimension is transformed using a channel–specific function from the list.</p>
</div>
<div id="build-the-gating-hierarchy-from-scratch" class="section level2">
<h2 class="hasAnchor">
<a href="#build-the-gating-hierarchy-from-scratch" class="anchor"></a>Build the gating hierarchy from scratch</h2>
<p><code>GatingSet</code> provides methods to build a gating tree from raw FCS files and add or remove flowCore gates (or populations) to or from it.</p>
<p>We start from a <code>flowSet</code> that contains three ungated flow samples:</p>
<div class="sourceCode" id="cb57"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">flowCore</span>)
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">GvHD</span>)
<span class="co">#select raw flow data</span>
<span class="no">fs</span> <span class="kw">&lt;-</span> <span class="no">GvHD</span>[<span class="fl">1</span>:<span class="fl">2</span>]</pre></body></html></div>
<p>Then construct a <code>GatingSet</code> from the <code>flowSet</code>:</p>
<div class="sourceCode" id="cb58"><html><body><pre class="r"><span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/GatingSet-class.html">GatingSet</a></span>(<span class="no">fs</span>)</pre></body></html></div>
<p>Then compensate it:</p>
<div class="sourceCode" id="cb59"><html><body><pre class="r"><span class="no">cfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"extdata"</span>,<span class="st">"compdata"</span>,<span class="st">"compmatrix"</span>, <span class="kw">package</span><span class="kw">=</span><span class="st">"flowCore"</span>)
<span class="no">comp.mat</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.table</a></span>(<span class="no">cfile</span>, <span class="kw">header</span><span class="kw">=</span><span class="fl">TRUE</span>, <span class="kw">skip</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">check.names</span> <span class="kw">=</span> <span class="fl">FALSE</span>)
<span class="co">## create a compensation object </span>
<span class="no">comp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/compensation-class.html">compensation</a></span>(<span class="no">comp.mat</span>)
<span class="co">#compensate GatingSet</span>
<span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compensate.html">compensate</a></span>(<span class="no">gs</span>, <span class="no">comp</span>)</pre></body></html></div>
<p><span style="color:red"><strong>New</strong>: You can now pass a list of <code>compensation</code> objects with elements named by <code><a href="../reference/sampleNames.html">sampleNames(gs)</a></code> to achieve sample-specific compensations. e.g. </span></p>
<div class="sourceCode" id="cb60"><html><body><pre class="r"><span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/compensate.html">compensate</a></span>(<span class="no">gs</span>, <span class="no">comp.list</span>)</pre></body></html></div>
<p>Then we can transform it with any transformation defined by the user through <code>trans_new</code> function of <code>scales</code> package.</p>
<div class="sourceCode" id="cb61"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">require</a></span>(<span class="no">scales</span>)
<span class="no">trans.func</span> <span class="kw">&lt;-</span> <span class="no">asinh</span>
<span class="no">inv.func</span> <span class="kw">&lt;-</span> <span class="no">sinh</span>
<span class="no">trans.obj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://scales.r-lib.org//reference/trans_new.html">trans_new</a></span>(<span class="st">"myAsinh"</span>, <span class="no">trans.func</span>, <span class="no">inv.func</span>)</pre></body></html></div>
<p>The <code>inverse</code> transformation is required so that the gates and data can be visualized in <code>transformed</code> scale while the axis label still remains in the raw scale. Optionally, the <code>breaks</code> and <code>format</code> functions can be supplied to further customize the appearance of axis labels.</p>
<p>Besides doing all these by hand, we also provide some buildin transformations: <code>asinhtGml2_trans</code>, <code>flowjo_biexp_trans</code>, <code>flowjo_fasinh_trans</code> and <code>logicle_trans</code>. These are all very commonly used transformations in flow data analysis. User can construct the transform object by simply one-line of code. e.g.</p>
<div class="sourceCode" id="cb62"><html><body><pre class="r"><span class="no">trans.obj</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/asinhtGml2_trans.html">asinhtGml2_trans</a></span>()
<span class="no">trans.obj</span></pre></body></html></div>
<pre><code>## Transformer:  asinhtGml2</code></pre>
<p>Once a <code>transformer</code> object is created, we must convert it to <code>transformerList</code> for <code>GatingSet</code> to use.</p>
<div class="sourceCode" id="cb64"><html><body><pre class="r"><span class="no">chnls</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">fs</span>)[<span class="fl">3</span>:<span class="fl">6</span>]
<span class="no">transList</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/transformerList.html">transformerList</a></span>(<span class="no">chnls</span>, <span class="no">trans.obj</span>)</pre></body></html></div>
<p>Alternatively, the overloaded <code>estimateLogicle</code> method can be used directly on <code>GatingHierarchy</code> to generate a <code>transformerList</code> object automatically.</p>
<div class="sourceCode" id="cb65"><html><body><pre class="r"><span class="fu"><a href="../reference/estimateLogicle.html">estimateLogicle</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="no">chnls</span>)</pre></body></html></div>
<pre><code>## $`FL1-H`
## Transformer:  logicle 
## 
## $`FL2-H`
## Transformer:  logicle 
## 
## $`FL3-H`
## Transformer:  logicle 
## 
## $`FL2-A`
## Transformer:  logicle 
## 
## attr(,"class")
## [1] "transformerList" "list"</code></pre>
<p>Now we can transform our <code>GatingSet</code> with this <code>transformerList</code> object. It will also store the transformation in the <code>GatingSet</code> and can be used to inverse-transform the data.</p>
<div class="sourceCode" id="cb67"><html><body><pre class="r"><span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/transform.html">transform</a></span>(<span class="no">gs</span>, <span class="no">transList</span>)
<span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>## [1] "root"</code></pre>
<p>It now only contains the root node. We can add our first <code>rectangleGate</code>:</p>
<div class="sourceCode" id="cb69"><html><body><pre class="r"><span class="no">rg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/rectangleGate-class.html">rectangleGate</a></span>(<span class="st">"FSC-H"</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">200</span>,<span class="fl">400</span>), <span class="st">"SSC-H"</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">250</span>, <span class="fl">400</span>), <span class="kw">filterId</span><span class="kw">=</span><span class="st">"rectangle"</span>)
<span class="no">nodeID</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gs_pop_add.html">gs_pop_add</a></span>(<span class="no">gs</span>, <span class="no">rg</span>)
<span class="no">nodeID</span></pre></body></html></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb71"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>## [1] "root"       "/rectangle"</code></pre>
<p>Note that the gate is added to the root node by default if the parent is not specified. Then we add a <code>quadGate</code> to the new population generated by the <code>rectangleGate</code> which is named after the <code>filterId</code> of the gate because the name was not specified when the <code>add</code> method was called.</p>
<div class="sourceCode" id="cb73"><html><body><pre class="r"><span class="no">qg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/quadGate-class.html">quadGate</a></span>(<span class="st">"FL1-H"</span><span class="kw">=</span> <span class="fl">0.2</span>, <span class="st">"FL2-H"</span><span class="kw">=</span> <span class="fl">0.4</span>)
<span class="no">nodeIDs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gs_pop_add.html">gs_pop_add</a></span>(<span class="no">gs</span>,<span class="no">qg</span>,<span class="kw">parent</span><span class="kw">=</span><span class="st">"rectangle"</span>)
<span class="no">nodeIDs</span></pre></body></html></div>
<pre><code>## [1] 3 4 5 6</code></pre>
<div class="sourceCode" id="cb75"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>## [1] "root"                          "/rectangle"                   
## [3] "/rectangle/CD15 FITC-CD45 PE+" "/rectangle/CD15 FITC+CD45 PE+"
## [5] "/rectangle/CD15 FITC+CD45 PE-" "/rectangle/CD15 FITC-CD45 PE-"</code></pre>
<p>Here <code>quadGate</code> produces four population nodes/populations named after the dimensions of the gate if names are not specified.</p>
<p>A Boolean gate can also be defined and added to GatingSet:</p>
<div class="sourceCode" id="cb77"><html><body><pre class="r"><span class="no">bg</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/booleanFilter-class.html">booleanFilter</a></span>(<span class="no">`CD15 FITC-CD45 PE+|CD15 FITC+CD45 PE-`</span>)
<span class="no">bg</span></pre></body></html></div>
<pre><code>## booleanFilter filter 'CD15 FITC-CD45 PE+|CD15 FITC+CD45 PE-' evaluating the expression:
## CD15 FITC-CD45 PE+|CD15 FITC+CD45 PE-</code></pre>
<div class="sourceCode" id="cb79"><html><body><pre class="r"><span class="no">nodeID2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gs_pop_add.html">gs_pop_add</a></span>(<span class="no">gs</span>,<span class="no">bg</span>,<span class="kw">parent</span><span class="kw">=</span><span class="st">"rectangle"</span>)
<span class="no">nodeID2</span></pre></body></html></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode" id="cb81"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>## [1] "root"                                            
## [2] "/rectangle"                                      
## [3] "/rectangle/CD15 FITC-CD45 PE+"                   
## [4] "/rectangle/CD15 FITC+CD45 PE+"                   
## [5] "/rectangle/CD15 FITC+CD45 PE-"                   
## [6] "/rectangle/CD15 FITC-CD45 PE-"                   
## [7] "/rectangle/CD15 FITC-CD45 PE+|CD15 FITC+CD45 PE-"</code></pre>
<p>The gating hierarchy is plotted by:</p>
<div class="sourceCode" id="cb83"><html><body><pre class="r"><span class="fu"><a href="../reference/plot-methods.html">plot</a></span>(<span class="no">gs</span>, <span class="kw">bool</span><span class="kw">=</span><span class="fl">TRUE</span>)</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/plot-gh-1.png" width="700"> Note that Boolean gate is skipped by default and thus needs to be enabled explictily.</p>
<p>Now all the gates are added to the gating tree but the actual data is not gated yet. This is done by calling the <code>recompute</code> method explictily:</p>
<div class="sourceCode" id="cb84"><html><body><pre class="r"><span class="fu"><a href="../reference/recompute.html">recompute</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<p>After gating is finished, gating results can be visualized by the <code>autoplot</code> method:</p>
<div class="sourceCode" id="cb85"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">gs</span>,<span class="st">"rectangle"</span>) <span class="co">#plot one Gate</span></pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/autoplot-rect-1.png" width="700"> Multiple gates can be plotted on the same panel:</p>
<div class="sourceCode" id="cb86"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">gs</span>, <span class="fu"><a href="../reference/gs_pop_get_children.html">gs_pop_get_children</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]], <span class="st">"rectangle"</span>)[<span class="fl">1</span>:<span class="fl">4</span>])</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/autoplot-multiple-1.png" width="700"> We may also want to plot all the gates without specifying the gate index:</p>
<div class="sourceCode" id="cb87"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/ggcyto/man/autoplot.html">autoplot</a></span>(<span class="no">gs</span><span class="kw">[[</span><span class="fl">1</span>]])</pre></body></html></div>
<p><img src="flowWorkspace-Introduction_files/figure-html/autoplot-gh-bool-1.png" width="700"></p>
<p>If we want to remove one node, simply:</p>
<div class="sourceCode" id="cb88"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_pop_add.html">Rm</a></span>(<span class="st">'rectangle'</span>, <span class="no">gs</span>)</pre></body></html></div>
<pre><code>## Warning: 'Rm' is deprecated.
## Use 'gs_pop_remove' instead.
## See help("Deprecated")</code></pre>
<div class="sourceCode" id="cb90"><html><body><pre class="r"><span class="fu"><a href="../reference/gs_get_pop_paths.html">gs_get_pop_paths</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<pre><code>## [1] "root"</code></pre>
<p>As we see, removing one node causes all its descendants to be removed as well.</p>
<div id="archive-and-clone" class="section level3">
<h3 class="hasAnchor">
<a href="#archive-and-clone" class="anchor"></a>Archive and Clone</h3>
<p>Oftentimes, we need to save a <code>GatingSet</code> including the gated flow data, gates, and populations to disk and reload it later on. This can be done by:</p>
<div class="sourceCode" id="cb92"><html><body><pre class="r"><span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>()
<span class="fu"><a href="../reference/save_gs.html">save_gs</a></span>(<span class="no">gs</span>,<span class="kw">path</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">tmp</span>,<span class="st">"my_gs"</span>))
<span class="no">gs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/save_gs.html">load_gs</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">tmp</span>,<span class="st">"my_gs"</span>))</pre></body></html></div>
<p>We also provide the <code>clone</code> method to make a full copy of an existing <code>GatingSet</code>:</p>
<div class="sourceCode" id="cb93"><html><body><pre class="r"><span class="no">gs_gs_cloned</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/gs_clone.html">clone</a></span>(<span class="no">gs</span>)</pre></body></html></div>
<p>Note that the <code>GatingSet</code> is a purely reference class with an external pointer that points to the internal ‘C’ data structure. So make sure to use these methods in order to save or make a copy of an existing <code>GatingSet</code> object. The regular R assignment (&lt;-) or <code>save</code> routine doesn’t work as expected for <code>GatingSet</code> objects.</p>
</div>
</div>
<div id="the-cytoframe-and-cytoset-classes" class="section level2">
<h2 class="hasAnchor">
<a href="#the-cytoframe-and-cytoset-classes" class="anchor"></a>The cytoframe and cytoset classes</h2>
<p>The <code>GatingSet</code> class no longer uses <code>flowFrame</code> and <code>flowSet</code> objects for containing the underlying flow data, but rather now uses the analogous <code>cytoframe</code> and <code>cytoset</code> classes. <code>cytoframe</code> and <code>cytoset</code> are essentially reference classes with pointers to internal ‘C’ data structures and thus enable <code>GatingSet</code> operations to be performed more efficiently.</p>
<p>While working with <code>GatingSet</code> objects will often entail working with <code>cytoframe</code> and <code>cytoset</code> objects implicitly, it is also possible to directly work with objects of both of these classes.</p>
<div id="reading-a-cytoframe" class="section level3">
<h3 class="hasAnchor">
<a href="#reading-a-cytoframe" class="anchor"></a>Reading a <code>cytoframe</code>
</h3>
<p>Instead of <code><a href="https://rdrr.io/pkg/flowCore/man/read.FCS.html">read.FCS()</a></code>, <code>cytoframe</code> objects can be created from FCS files with the <code><a href="../reference/load_cytoframe_from_fcs.html">load_cytoframe_from_fcs()</a></code> method. The optional <code>num_threads</code> argument allows for parallelization of the read operation.</p>
<div class="sourceCode" id="cb94"><html><body><pre class="r"><span class="no">files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">path</span>, <span class="st">"Cyto"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">cf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/load_cytoframe_from_fcs.html">load_cytoframe_from_fcs</a></span>(<span class="no">files</span>[<span class="fl">1</span>], <span class="kw">num_threads</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="no">cf</span></pre></body></html></div>
<pre><code>## cytoframe object 'CytoTrol_CytoTrol_1.fcs'
## with 119531 cells and 12 observables:
##        name         desc  range minRange maxRange
## $P1   FSC-A         &lt;NA&gt; 262143        0   262143
## $P2   FSC-H         &lt;NA&gt; 262143        0   262143
## $P3   FSC-W         &lt;NA&gt; 262143        0   262143
## $P4   SSC-A         &lt;NA&gt; 262143        0   262143
## $P5  B710-A  CD4 PcpCy55 262143     -111   262143
## $P6  R660-A     CD38 APC 262143     -111   262143
## $P7  R780-A    CD8 APCH7 262143     -111   262143
## $P8  V450-A     CD3 V450 262143     -111   262143
## $P9  V545-A  HLA-DR V500 262143     -111   262143
## $P10 G560-A      CCR7 PE 262143     -111   262143
## $P11 G780-A CD45RA PECy7 262143     -111   262143
## $P12   Time         &lt;NA&gt; 262143        0   262143
## 199 keywords are stored in the 'description' slot</code></pre>
<p>Instead of using <code><a href="https://rdrr.io/pkg/flowCore/man/read.FCSheader.html">read.FCSheader()</a></code> to obtain only the header of the file, just use the <code>text.only</code> argument to <code><a href="../reference/load_cytoframe_from_fcs.html">load_cytoframe_from_fcs()</a></code>.</p>
<div class="sourceCode" id="cb96"><html><body><pre class="r"><span class="no">cfh</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/load_cytoframe_from_fcs.html">load_cytoframe_from_fcs</a></span>(<span class="no">files</span>[<span class="fl">1</span>], <span class="kw">text.only</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">cfh</span></pre></body></html></div>
<pre><code>## cytoframe object '7817b649-f92d-4103-bd46-6364fdbe85db'
## with 0 cells and 12 observables:
##        name         desc  range minRange maxRange
## $P1   FSC-A         &lt;NA&gt; 262144        0   262144
## $P2   FSC-H         &lt;NA&gt; 262144        0   262144
## $P3   FSC-W         &lt;NA&gt; 262144        0   262144
## $P4   SSC-A         &lt;NA&gt; 262144        0   262144
## $P5  B710-A  CD4 PcpCy55 262144        0   262144
## $P6  R660-A     CD38 APC 262144        0   262144
## $P7  R780-A    CD8 APCH7 262144        0   262144
## $P8  V450-A     CD3 V450 262144        0   262144
## $P9  V545-A  HLA-DR V500 262144        0   262144
## $P10 G560-A      CCR7 PE 262144        0   262144
## $P11 G780-A CD45RA PECy7 262144        0   262144
## $P12   Time         &lt;NA&gt; 262144        0   262144
## 171 keywords are stored in the 'description' slot</code></pre>
</div>
<div id="cytoframe-accessors" class="section level3">
<h3 class="hasAnchor">
<a href="#cytoframe-accessors" class="anchor"></a><code>cytoframe</code> Accessors</h3>
<p>The accessor methods function the same as they would for a <code>flowFrame</code></p>
<div class="sourceCode" id="cb98"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">dim</a></span>(<span class="no">cf</span>)</pre></body></html></div>
<pre><code>##     events parameters 
##     119531         12</code></pre>
<div class="sourceCode" id="cb100"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">cf</span>)</pre></body></html></div>
<pre><code>##  [1] "FSC-A"  "FSC-H"  "FSC-W"  "SSC-A"  "B710-A" "R660-A" "R780-A" "V450-A"
##  [9] "V545-A" "G560-A" "G780-A" "Time"</code></pre>
<div class="sourceCode" id="cb102"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf</span>))</pre></body></html></div>
<pre><code>##          FSC-A  FSC-H    FSC-W     SSC-A   B710-A   R660-A    R780-A    V450-A
## [1,] 140733.05 133376 69150.98  91113.96 22311.24 35576.07  14302.16 16232.649
## [2,]  26195.32  26207 65506.79  10115.28     5.04   447.93    682.56    43.700
## [3,]  64294.02  51594 81667.89 174620.03   371.28   851.62    -66.36   335.350
## [4,] 128393.87 103613 81210.08 150625.44  1494.36  5672.20   2979.09  1492.450
## [5,] 127717.88 119616 69974.92  76954.91  2545.20  2272.83 124635.93  8608.899
## [6,] 134347.02 125651 70071.60  70116.48 23052.96  1758.54   5281.15  4849.750
##        V545-A   G560-A   G780-A Time
## [1,]  7644.65  4113.60 12672.00  0.2
## [2,]    77.90   -91.20    18.24  0.4
## [3,]   971.85   273.60   271.68  0.6
## [4,] 28790.70   771.84   988.80  0.6
## [5,]  4190.45 14306.88 58977.60  0.7
## [6,]  2859.50  2249.28  1560.96  0.7</code></pre>
<div class="sourceCode" id="cb104"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">spillover</a></span>(<span class="no">cf</span>)</pre></body></html></div>
<pre><code>## $SPILL
##            B710-A       R660-A       R780-A       V450-A      V545-A
## [1,] 1.000000e+00 3.143890e-02 0.1909655363 3.057568e-03 0.002047231
## [2,] 5.537983e-03 1.000000e+00 0.1768123886 0.000000e+00 0.000000000
## [3,] 9.958625e-05 9.847661e-03 1.0000000000 0.000000e+00 0.000000000
## [4,] 0.000000e+00 8.909845e-05 0.0000000000 1.000000e+00 0.451194675
## [5,] 2.477092e-03 5.235156e-04 0.0000000000 3.796154e-02 1.000000000
## [6,] 1.172236e-01 1.642721e-03 0.0003321532 0.000000e+00 0.000000000
## [7,] 1.420516e-02 4.568956e-04 0.1754022374 8.902497e-05 0.000000000
##            G560-A      G780-A
## [1,] 3.442413e-04 0.071933810
## [2,] 0.000000e+00 0.006618897
## [3,] 0.000000e+00 0.035399709
## [4,] 1.082746e-04 0.000000000
## [5,] 6.361807e-05 0.000000000
## [6,] 1.000000e+00 0.009219359
## [7,] 4.096870e-02 1.000000000
## 
## $spillover
## NULL
## 
## $`$SPILLOVER`
## NULL</code></pre>
<div class="sourceCode" id="cb106"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="fu"><a href="../reference/keyword.html">keyword</a></span>(<span class="no">cf</span>))</pre></body></html></div>
<pre><code>## $FCSversion
## [1] "3"
## 
## $`$BEGINANALYSIS`
## [1] "0"
## 
## $`$ENDANALYSIS`
## [1] "0"
## 
## $`$BEGINSTEXT`
## [1] "0"
## 
## $`$ENDSTEXT`
## [1] "0"
## 
## $`$BEGINDATA`
## [1] "3264"</code></pre>
</div>
<div id="pass-by-reference" class="section level3">
<h3 class="hasAnchor">
<a href="#pass-by-reference" class="anchor"></a>Pass By Reference</h3>
<p>As <code>cytoframe</code> and <code>cytoset</code> are reference classes, copying objects of either class by the assignment operator (<code>&lt;-</code>) will simply provide a copy of the external pointer and so changes made to the copy will also affect the original object.</p>
<div class="sourceCode" id="cb108"><html><body><pre class="r"><span class="no">cf1</span> <span class="kw">&lt;-</span> <span class="no">cf</span> <span class="co"># cf is a reference</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">cf1</span>)[<span class="fl">1</span>]</pre></body></html></div>
<pre><code>## [1] "FSC-A"</code></pre>
<div class="sourceCode" id="cb110"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">cf1</span>)[<span class="fl">1</span>] <span class="kw">&lt;-</span> <span class="st">"t"</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">cf</span>)[<span class="fl">1</span>] <span class="co"># The change affects the original cf object</span></pre></body></html></div>
<pre><code>## [1] "t"</code></pre>
</div>
<div id="views" class="section level3">
<h3 class="hasAnchor">
<a href="#views" class="anchor"></a>Views</h3>
<p>Extracting a subset of a <code>cytoframe</code> is not computationally intensive, as it merely constructs a view of the data of the original <code>cytoframe</code>. However, both objects still share the same underlying pointer to all of the data and thus changes to a view will affect the data of the original <code>cytoframe</code>.</p>
<div class="sourceCode" id="cb112"><html><body><pre class="r"><span class="no">cf1</span> <span class="kw">&lt;-</span> <span class="no">cf</span>[<span class="fl">1</span>:<span class="fl">10</span>, <span class="fl">2</span>:<span class="fl">3</span>]
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">dim</a></span>(<span class="no">cf1</span>)</pre></body></html></div>
<pre><code>##     events parameters 
##         10          2</code></pre>
<div class="sourceCode" id="cb114"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf</span>)[<span class="fl">2</span>,<span class="fl">3</span>]</pre></body></html></div>
<pre><code>##    FSC-W 
## 65506.79</code></pre>
<div class="sourceCode" id="cb116"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf1</span>)[<span class="fl">2</span>,<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">0</span> <span class="co"># data change affects the orignal cf</span>
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf</span>)[<span class="fl">2</span>,<span class="fl">3</span>]</pre></body></html></div>
<pre><code>## FSC-W 
##     0</code></pre>
<p>To construct a new view of an entire <code>cytoframe</code>, use the <code>[]</code> method rather than the <code>&lt;-</code> operator. This will ensure that a new view is created to the full underlying dataset.</p>
<div class="sourceCode" id="cb118"><html><body><pre class="r"><span class="no">cf1</span> <span class="kw">&lt;-</span> <span class="no">cf</span>[]</pre></body></html></div>
</div>
<div id="deep-copy" class="section level3">
<h3 class="hasAnchor">
<a href="#deep-copy" class="anchor"></a>Deep Copy</h3>
<p>It is also possible to perform a deep copy of a <code>cytoframe</code> or a view of it, resulting in two objects pointing to distinct C-level representations of the data. This is accomplished with the <code>realize_view</code> method.</p>
<div class="sourceCode" id="cb119"><html><body><pre class="r"><span class="no">cf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/load_cytoframe_from_fcs.html">load_cytoframe_from_fcs</a></span>(<span class="no">files</span>[<span class="fl">1</span>], <span class="kw">num_threads</span> <span class="kw">=</span> <span class="fl">4</span>) <span class="co"># starting fresh</span>
<span class="no">cf1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cytoframe.html">realize_view</a></span>(<span class="no">cf</span>[<span class="fl">1</span>:<span class="fl">10</span>, <span class="fl">2</span>:<span class="fl">3</span>])
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">dim</a></span>(<span class="no">cf1</span>)</pre></body></html></div>
<pre><code>##     events parameters 
##         10          2</code></pre>
<div class="sourceCode" id="cb121"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf</span>)[<span class="fl">2</span>,<span class="fl">3</span>]</pre></body></html></div>
<pre><code>##    FSC-W 
## 65506.79</code></pre>
<div class="sourceCode" id="cb123"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf1</span>)[<span class="fl">2</span>,<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">0</span> <span class="co"># data change no longer affects the original cf</span>
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf</span>)[<span class="fl">2</span>,<span class="fl">3</span>]</pre></body></html></div>
<pre><code>##    FSC-W 
## 65506.79</code></pre>
<div class="sourceCode" id="cb125"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cf1</span>)[<span class="fl">2</span>,<span class="fl">2</span>] <span class="co"># but does affect the separate data of cf1</span></pre></body></html></div>
<pre><code>## FSC-W 
##     0</code></pre>
<p>Similarly, if a deep copy of all of the data is desired (not a subset), simply call <code>realize_view</code> on the original <code>cytoframe</code>.</p>
</div>
<div id="interconversion-between-cytoframe-and-flowframe" class="section level3">
<h3 class="hasAnchor">
<a href="#interconversion-between-cytoframe-and-flowframe" class="anchor"></a>Interconversion between <code>cytoframe</code> and <code>flowFrame</code>
</h3>
<p>Conversion of objects between the <code>cytoframe</code> and <code>flowFrame</code> classes is accomplished with a few coercion methods</p>
<div class="sourceCode" id="cb127"><html><body><pre class="r"><span class="no">fr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/convert.html">cytoframe_to_flowFrame</a></span>(<span class="no">cf</span>)
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">fr</span>)</pre></body></html></div>
<pre><code>## [1] "flowFrame"
## attr(,"package")
## [1] "flowCore"</code></pre>
<div class="sourceCode" id="cb129"><html><body><pre class="r"><span class="no">cf_back</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/convert.html">flowFrame_to_cytoframe</a></span>(<span class="no">fr</span>)
<span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span>(<span class="no">cf_back</span>)</pre></body></html></div>
<pre><code>## [1] "cytoframe"
## attr(,"package")
## [1] "flowWorkspace"</code></pre>
<p>Of course (as a side note), here <code><a href="../reference/convert.html">flowFrame_to_cytoframe()</a></code> had no knowledge of the <code>cytoframe</code> origin of <code>fr</code>, so <code>cf_back</code> points to a new copy of the underlying data.</p>
<div class="sourceCode" id="cb131"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(<span class="no">cf</span>@<span class="kw">pointer</span>, <span class="no">cf_back</span>@<span class="kw">pointer</span>) <span class="co"># These point to distinct copies of the data</span></pre></body></html></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="savingloading-a-cytoframe-in-h5" class="section level3">
<h3 class="hasAnchor">
<a href="#savingloading-a-cytoframe-in-h5" class="anchor"></a>Saving/Loading a <code>cytoframe</code> in h5</h3>
<p>A couple of methods handle the task of writing or reading a <code>cytoframe</code> in the HDF5 format on disk</p>
<div class="sourceCode" id="cb133"><html><body><pre class="r"><span class="no">tmpfile</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>(<span class="kw">fileext</span> <span class="kw">=</span> <span class="st">".h5"</span>)
<span class="fu"><a href="../reference/cf_write_h5.html">cf_write_h5</a></span>(<span class="no">cf</span>, <span class="no">tmpfile</span>)
<span class="no">loaded</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/load_cytoframe_from_h5.html">load_cytoframe_from_h5</a></span>(<span class="no">tmpfile</span>)</pre></body></html></div>
</div>
<div id="cytoset-methods" class="section level3">
<h3 class="hasAnchor">
<a href="#cytoset-methods" class="anchor"></a><code>cytoset</code> methods</h3>
<p>Most of the above methods for <code>cytoframe</code> objects have <code>cytoset</code> analogs.</p>
<p>For reading in a <code>cytoset</code> from FCS files, use <code>load_cytoset_from_fcs</code></p>
<div class="sourceCode" id="cb134"><html><body><pre class="r"><span class="no">files</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(<span class="no">path</span>, <span class="st">"Cyto"</span>, <span class="kw">full.names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">cs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/load_cytoset_from_fcs.html">load_cytoset_from_fcs</a></span>(<span class="no">files</span>, <span class="kw">num_threads</span> <span class="kw">=</span> <span class="fl">4</span>)
<span class="no">cs</span></pre></body></html></div>
<pre><code>## A cytoset with 2 samples.
## 
##   column names:
##     FSC-A, FSC-H, FSC-W, SSC-A, B710-A, R660-A, R780-A, V450-A, V545-A, G560-A, G780-A, Time</code></pre>
<p>Once constructed, it can be saved/loaded through more efficient archive format.</p>
<div class="sourceCode" id="cb136"><html><body><pre class="r"><span class="no">tmp</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempfile</a></span>()
<span class="fu"><a href="../reference/save_cytoset.html">save_cytoset</a></span>(<span class="no">cs</span>, <span class="no">tmp</span>)
<span class="no">cs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/save_cytoset.html">load_cytoset</a></span>(<span class="no">tmp</span>, <span class="kw">h5_readonly</span> <span class="kw">=</span> <span class="fl">FALSE</span>)</pre></body></html></div>
<p>note that <code>h5_readonly</code> is set to <code>TRUE</code> by default to protect the data from accidental changes. So it has to be turned off explicitly if your want to modify the loaded <code>cs</code></p>
<p>The accessor methods function the same as they would for a <code>flowSet</code></p>
<div class="sourceCode" id="cb137"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(<span class="no">cs</span>)</pre></body></html></div>
<pre><code>##  [1] "FSC-A"  "FSC-H"  "FSC-W"  "SSC-A"  "B710-A" "R660-A" "R780-A" "V450-A"
##  [9] "V545-A" "G560-A" "G780-A" "Time"</code></pre>
<p>Subsetting using <code><a href="../reference/brackets.html">[</a></code> will work in a manner similar to that for a <code>flowSet</code>, but will result in another <code>cytoset</code> that is a view in to the data of the original <code>cytoset</code>. The <code><a href="https://rdrr.io/pkg/flowCore/man/Subset-methods.html">Subset()</a></code> method, when called on a <code>cytoset</code>, will also return a <code>cytoset</code> that is a view in to the orignal data rather than a deep copy.</p>
<div class="sourceCode" id="cb139"><html><body><pre class="r"><span class="no">sub_cs</span> <span class="kw">&lt;-</span> <span class="no">cs</span>[<span class="fl">1</span>]</pre></body></html></div>
<p><strong>Important:</strong> Perhaps unexpectedly, extraction using <code><a href="../reference/brackets.html">[[</a></code> on a <code>cytoset</code> will by default return a <code>flowFrame</code> instead of a <code>cytoframe</code> and so will represent a copy of the underlying data rather than a view. Thus, altering the result of the extraction <strong>will not</strong> alter the underlying data of the original <code>cytoset</code>. This is done for the sake of backwards compatibility with older user scripts.</p>
<div class="sourceCode" id="cb140"><html><body><pre class="r"><span class="no">sub_fr</span> <span class="kw">&lt;-</span> <span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]]
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">2</span>,<span class="fl">2</span>]</pre></body></html></div>
<pre><code>## FSC-H 
## 26207</code></pre>
<div class="sourceCode" id="cb142"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">sub_fr</span>)[<span class="fl">2</span>,<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">0</span> <span class="co"># This WILL NOT affect the original data</span>
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">2</span>,<span class="fl">2</span>]</pre></body></html></div>
<pre><code>## FSC-H 
## 26207</code></pre>
<p>To circumvent this behavior and instead return a <code>cytoframe</code> that represents a view in to the data of the <code>original</code> cytoset, you need to use the <code>returnType</code> argument.</p>
<div class="sourceCode" id="cb144"><html><body><pre class="r"><span class="no">sub_cf</span> <span class="kw">&lt;-</span> <span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>, <span class="kw">returnType</span> <span class="kw">=</span> <span class="st">"cytoframe"</span>]]
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">2</span>,<span class="fl">2</span>]</pre></body></html></div>
<pre><code>## FSC-H 
## 26207</code></pre>
<div class="sourceCode" id="cb146"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">sub_cf</span>)[<span class="fl">2</span>,<span class="fl">2</span>] <span class="kw">&lt;-</span> <span class="fl">0</span> <span class="co"># This WILL affect the original data</span>
<span class="fu"><a href="https://rdrr.io/pkg/flowCore/man/flowFrame-class.html">exprs</a></span>(<span class="no">cs</span><span class="kw">[[</span><span class="fl">1</span>]])[<span class="fl">2</span>,<span class="fl">2</span>]</pre></body></html></div>
<pre><code>## FSC-H 
##     0</code></pre>
<p>Alternatively, if it is easier to remember, <code>get_cytoframe_from_cs</code> will accomplish the same goal</p>
<div class="sourceCode" id="cb148"><html><body><pre class="r"><span class="no">sub_cf</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/cytoset.html">get_cytoframe_from_cs</a></span>(<span class="no">cs</span>,<span class="fl">1</span>)</pre></body></html></div>
<p>Finally, the <code>[]</code> and <code><a href="../reference/cytoframe.html">realize_view()</a></code> methods work in a similar manner for <code>cytoset</code> objects as <code>cytoframe</code> objects. <code>[]</code> will return a view in to the original data while <code><a href="../reference/cytoframe.html">realize_view()</a></code> will perform a deep copy.</p>
</div>
</div>
<div id="troubleshooting-and-error-reporting" class="section level2">
<h2 class="hasAnchor">
<a href="#troubleshooting-and-error-reporting" class="anchor"></a>Troubleshooting and error reporting</h2>
<p>If this package is throwing errors when parsing your workspace, contact the package author by emails for post an issue on <a href="https://github.com/RGLab/flowWorkspace/issues" class="uri">https://github.com/RGLab/flowWorkspace/issues</a>. If you can send your workspace by email, we can test, debug, and fix the package so that it works for you. Our goal is to provide a tool that works, and that people find useful.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Greg Finak,Mike Jiang <wjiang2>.</wjiang2></p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
